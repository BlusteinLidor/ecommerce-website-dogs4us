<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:p="http://primefaces.org/ui">
<f:metadata>
    <f:event type="preRenderView" listener="#{productManagementBean.redirectIfNotAdmin}" />
</f:metadata>
<h:head>
    <title>Product Management</title>
    <h:outputStylesheet library="webjars" name="primeflex/3.3.1/primeflex.min.css"/>
</h:head>

<h:body styleClass="layout-wrapper bg-gray-50">
    <ui:include src="navbar.xhtml"/>

    <div class="p-4">
        <h2 class="text-2xl font-bold mb-4">üõ†Ô∏è Product Management</h2>

        <h:form>
            <div class="flex flex-column gap-3 mb-3">
                <h:outputLabel for="name" value="Product Name"/>
                <h:inputText id="name" value="#{productManagementBean.product.name}" required="true"
                             styleClass="p-inputtext w-full"/>

                <h:outputLabel for="description" value="Description"/>
                <h:inputTextarea id="description" value="#{productManagementBean.product.description}" required="true"
                                 styleClass="p-inputtextarea w-full" rows="3"/>

                <h:outputLabel for="price" value="Price"/>
                <h:inputText id="price" value="#{productManagementBean.product.price}" required="true"
                             styleClass="p-inputtext w-full"/>

                <h:outputLabel for="imageURL" value="Image URL"/>
                <h:inputText id="imageURL" value="#{productManagementBean.product.imageURL}" required="true"
                             styleClass="p-inputtext w-full"/>

                <h:outputLabel for="category" value="Category"/>
                <h:inputText id="category" value="#{productManagementBean.product.category}" required="true"
                             styleClass="p-inputtext w-full"/>

                <h:outputLabel for="quantity" value="Quantity"/>
                <h:inputText id="quantity" value="#{productManagementBean.product.stockQuantity}" required="true"
                             styleClass="p-inputtext w-full"/>

                <h:outputLabel for="custom" value="Custom"/>
                <h:inputText id="custom" value="#{productManagementBean.customizableFieldsString}"
                             styleClass="p-inputtext w-full"/>
            </div>

            <h:commandButton value="Add Product"
                             rendered="#{not productManagementBean.editMode}"
                             action="#{productManagementBean.saveProduct}"
                             styleClass="p-button p-button-success mt-3"/>
            <h:commandButton value="Update Product"
                             rendered="#{productManagementBean.editMode}"
                             action="#{productManagementBean.updateProduct()}"
                             styleClass="p-button p-button-success mt-3"/>
            <h:commandButton value="Cancel editing"
                             rendered="#{productManagementBean.editMode}"
                             action="#{productManagementBean.cancelEditMode}"
                             styleClass="p-button p-button-success mt-3"/>
        </h:form>
        <h:messages globalOnly="false" style="color:red;" />

        <!-- Product List -->
        <h:form id="listForm">
            <ui:repeat value="#{productManagementBean.products}" var="prod">
                <div class="flex justify-content-between align-items-center border-round shadow-1 bg-white p-3 my-2">
                    <div>
                        <h:graphicImage value="#{prod.imageURL}" alt="#{prod.name}"
                                        style="width: 100%; border-radius: 8px; object-fit: cover; max-height: 100px;" />
                        <h4>#{prod.name}</h4>
                        <h6>#{prod.category}</h6>
                        <br/>
                        <p>#{prod.description}</p>
                        <p>In stock: #{prod.stockQuantity}</p>
                        <p><strong>$#{prod.price}</strong></p>
                    </div>
                    <div class="flex gap-2">
                        <h:commandButton value="Edit" action="#{productManagementBean.editProduct(prod)}"
                                         styleClass="p-button p-button-warning" />
                        <h:commandButton value="Delete" action="#{productManagementBean.deleteProduct(prod.id)}"
                                         styleClass="p-button p-button-danger" />
                    </div>
                </div>
            </ui:repeat>
        </h:form>
    </div>

</h:body>
</html>
