<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Dogs4Us - #{productPageBean.product.name}</title>
    <h:outputStylesheet library="webjars" name="primeflex/3.3.1/primeflex.min.css"/>
    <h:outputStylesheet library="assets" name="css/layout.css"/>
</h:head>

<h:body styleClass="layout-wrapper bg-gray-50">

    <!-- ðŸ”µ Top Navigation Bar -->
    <ui:include src="navbar.xhtml"/>

    <!-- ðŸ¶ Product Display -->
    <div class="grid p-4">
        <div class="col-12 md:col-10 lg:col-8 mx-auto">
            <h:form id="productForm" styleClass="surface-card border-round p-4 shadow-3">

                <div class="flex flex-column md:flex-row gap-4">
                    <!-- ðŸ–¼ Image -->
                    <h:graphicImage value="#{productPageBean.product.imageURL}"
                                    alt="#{productPageBean.product.name}"
                                    styleClass="w-full md:w-10 border-round shadow-1" />

                    <!-- ðŸ“„ Info & Controls -->
                    <div class="flex flex-column gap-3 w-full">
                        <h2 class="text-3xl font-bold text-gray-800">#{productPageBean.product.name}</h2>

                        <p class="text-base text-gray-700"><strong>Description:</strong><br/>#{productPageBean.product.description}</p>

                        <p class="text-base text-gray-700">
                            <strong>Customization:</strong>
                            <br/>
                            <ui:repeat value="#{productPageBean.customFieldItemList}" var="customField">
                                <div class="mb-3">
                                    <label class="block text-sm font-medium mb-1">#{customField.name}</label>
                                    <h:inputText value="#{customField.value}" rendered="#{customField.name == 'Name'
                                    or customField.name == 'Phone'}"
                                                 styleClass="w-full p-2 border-1 border-gray-300 border-round"/>
                                    <h:panelGroup rendered="#{customField.name == 'Size'}">
                                        <p:selectOneMenu value="#{customField.value}">
                                            <f:selectItem itemLabel="Select One" itemValue=""/>
                                            <f:selectItems value="#{productPageBean.sizeSelectItemList}"/>
                                        </p:selectOneMenu>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{customField.name == 'Color'}">
                                        <p:selectOneMenu value="#{customField.value}">
                                            <f:selectItem itemLabel="Select One" itemValue=""/>
                                            <f:selectItems value="#{productPageBean.colorSelectItemList}"/>
                                        </p:selectOneMenu>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{customField.name == 'Image'}">
                                        <h:form enctype="multipart/form-data">
                                            <p:fileUpload
                                                    value="#{imageUploadBean.file}"
                                                    mode="advanced"
                                                    label="Upload Image"
                                                    listener="#{imageUploadBean.handleFileUpload}"
                                                    auto="false"
                                                    allowTypes="/(\.|\/)(png|jpg|jpeg|gif)$/"
                                                    update="messages" />
                                            <p:growl id="messages" showDetail="true" />
                                        </h:form>

                                    </h:panelGroup>
                                </div>
                            </ui:repeat>
                        </p>

                        <p class="text-lg font-bold text-orange-800">
                            $#{productPageBean.product.price}
                        </p>

                        <!-- ðŸ”¢ Quantity Controls -->
                        <div class="flex align-items-center gap-2">
                            <h:commandButton value="âˆ’"
                                             action="#{productPageBean.decrementQuantity}"
                                             styleClass="p-button p-button-secondary p-button-rounded">
                                <f:ajax render="quantityDisplay" />
                            </h:commandButton>

                            <h:outputText id="quantityDisplay" value="#{productPageBean.quantity}" styleClass="text-xl font-bold text-gray-800" />

                            <h:commandButton value="+"
                                             action="#{productPageBean.incrementQuantity}"
                                             styleClass="p-button p-button-secondary p-button-rounded">
                                <f:ajax render="quantityDisplay" />
                            </h:commandButton>
                        </div>

                        <!-- ðŸ›’ Add to Cart -->
                        <h:commandButton value="Add to Cart"
                                         action="#{productPageBean.addToCart}"
                                         rendered="#{sessionUserBean.user != null and productPageBean.product.stockQuantity > 0}"
                                         styleClass="mt-3 p-button p-button-success text-white bg-orange-900 text-lg" />
                        <h:commandButton value="Login to add to cart"
                                         disabled="true"
                                         rendered="#{sessionUserBean.user == null and productPageBean.product.stockQuantity > 0}"
                                         styleClass="mt-3 p-button p-button-success text-white bg-gray-500 text-lg" />
                        <h:commandButton value="Out of stock"
                                         rendered="#{productPageBean.product.stockQuantity == 0}"
                                         disabled="true"
                                         styleClass="mt-3 p-button p-button-success text-white bg-gray-500 text-lg" />

                        <!-- ðŸ“ Messages -->
                        <h:messages globalOnly="true" styleClass="text-green-700 text-sm font-bold mt-2" />
                    </div>
                </div>
            </h:form>
        </div>
    </div>

    <!-- ðŸ“¦ Footer -->
    <ui:include src="footer.xhtml"/>

</h:body>
</html>
